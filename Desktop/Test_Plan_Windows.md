# Windows

## 1. Virtual files on Windows

### Precondition

1.  Open the desktop client
2.  Go to Account tab
3.  You can enable/disable virtual files support in the three dots menu

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify file status updates correctly after using "Free up space" with VFS off | 1. Add an account with VFS OFF <br/> 2. Disable the VFS <br/> 3. From the right-click context menu, ""Free up space"" of a file <br/> 4. Observe the ""Status"" column in the File Explorer | * Pending icon until space is freed <br/> * Cloud icon after the space is freed <br/> * Status: Available when online <br/> * Preview icon doesn't work (yet) | | |
| 2  | Verify "Free up space" on a folder updates folder and file statuses correctly | 1. From the right-click context menu, ""Free up space"" of a folder <br/> 2. Observe the ""Status"" column in the File Explorer | *   Folder Status: Available when online <br/> *   All files inside the folder have a cloud icon | | | 
| 3  | Verify "Always keep on this device" sets file status and icon correctly | 1. From the right-click context menu, ""Always keep on this device"" of a file <br/> 2. Observe the ""Status"" column in the File Explorer | * Status: Always available on this device <br/> * Icon: White tick in solid Green circle | | |
| 4  | Verify "Always keep on this device" sets folder and contained files status correctly | 1. From the right-click context menu, ""Always keep on this device"" of a folder <br/> 2. Observe the ""Status"" column in the File Explorer | * Folder Status: Always available on this device <br/>* Icon: White tick in solid Green circle <br/>* All files inside the folder have the status ""Always available on this device"" | | | 
| 5  | Verify folder status when contained files have mixed VFS states | Verify the status of a folder when some files are pinned, hydrated, and dehydrated | Folder Status: Available when online only <br/> Icon: Cloud | | | 
| 6  | Verify file hydration updates status and downloads the file correctly | 1.  Have a folder with two files <br/> 2.  ""Free up space"" of a file <br/> 3.  Double-click one file to hydrate it | The file has been downloaded by the file manager <br/> File Status: Available on this device | | | 
| 7  | Verify new file added during paused sync shows pending status and icon | 1. Pause sync <br/> 2. Add a new file locally | * Status: Sync pending <br/> * Icon: Pending (two blue syncing arrows) | | | 
| 8  | Verify warning is shown when attempting to download an online-only file while offline | 1.  ""Free up space"" of a file <br/> 2.  Go offline <br/> 3.  Download the file | Warning dialog ""Can't download online-only file"" has been displayed GitHub issue: [#7333](https://github.com/owncloud/client/issues/7333) | | | 
| 9  | Verify new account creation with VFS enabled via account wizard | Verify that you can create a new account with VFS using account wizard: <br/> 1. Click add an account <br/> 2. Add the server adress <br/> 3. Login  <br/> 4. Open Advanced configuration <br/> 5. Select ""Use virtual files"" | New account can be added with virtual files | | | 
| 10  | Verify adding a new folder or space with VFS enabled | Add a new folder/space with VFS: <br/> 1. Click ""Add folder""/""Add space""  <br/> 2. Pick a local folder <br/> 3. Select a remote destination folder <br/> 4. In the ""Deselect remote folders you do not wish to synchronise"" window choose ""Use virtual files <br/> 5. Add sync connection | New folder/space has been added with VFS on | | | 
| 11  | Verify VFS placeholder suffix and status after multi-step desktop client upgrade | Migration <4 -> 4 -> 5 <br/>2.10 -> 5.0 <br/> 1. Install 2.5.4 [Download here](https://download.owncloud.com/desktop/stable/ownCloud-2.5.4.11654.11466.msi) <br/> 2. Use server: ownCloud 10.12 (stable) `(docker run -p 8080:8080 -e OWNCLOUD_TRUSTED_DOMAINS=10.0.2.2 owncloud/server:10.12)` <br/> 3. Enable VFS <br/> 4. Sync something<br/> 5. Upgrato to 4.0.0 <br/> 6. Upgrade to <current-version> | Placeholder suffix on vfs files get disappear (suffix: "".owncloud"") <br/> Cloud icon appears in the Status column | | | 
| 12  | Verify disabling VFS downloads all files and makes dehydrated files available locally | Prepare a folder structure: <br/> 1. One dehydrated file <br/> 2. One hydrated file <br/> 3. One file with ""Always keep on this device"" <br/> 4. One folder with one hydrated and one dehydrated file <br/> 5. One folder with one dehydrated and one file with ""Always keep on this device"" <br/> Disable VFS | All files have been downloaded; the dehydrated files are now present in the file system <br/> GitHub issue [#11331](https://github.com/owncloud/client/issues/11331) | | | 
| 13  | Verify re-enabling VFS restores status icons and file/folder actions | Re-enable VFS | Icons are shown in the ""Status"" column of the File Explorer <br/> files/folders can be made ""Always keep on this device"" and ""Free up space"" | 

## 2. File operations

### Precondition

VFS is on

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify renaming a file updates it on the server | [Automated] Rename a file | File has been renamed on the server | | | 
| 2  | Verify warning is shown when deleting a virtual (online-only) file | Delete a virtual file (online only file) | Warning message is shown <br/> (Skip) <br/> Still Not Implemented: [#11234](https://github.com/owncloud/client/issues/11234) | | |
| 3  | Verify warning is shown when deleting a virtual (online-only) folder | Delete a virtual folder (online only) | Warning message is shown <br/> (Skip) Still Not Implemented: [#11234](https://github.com/owncloud/client/issues/11234) | | | 
| 4  | Verify editing a file downloads it and syncs changes to the server | [Automated] Edit content of a file | File has been downloaded and edited content has been synced on the server | | | 
| 5  | Verify copying an online-only virtual file downloads it and creates a hydrated copy | [Not Automated] <br/> 1.  Copy an online-only virtual file <br/> 2.  Paste it at the same location | Online only file gets downloaded before copying <br/> A new copy is created and both files are hydrated | | | 
| 6  | Verify copying an online-only virtual file outside sync folder downloads it first | [Automated] <br/> 1.  Copy online-only virtual file <br/> 2.  Paste it outside the owncloud sync folder | Online only file gets downloaded before copying | | | 
| 7  | Verify moving online-only file into pinned folder keeps it virtual | Move an online-only virtual file into 'Always available on this device' folder | Virtual file is moved without downloading. <br/> Other downloaded files are in pinned state. <br/> The folder overlay icon is converted to online-only (cloud icon) from pinned | | | 
| 8  | Verify moving dehydrated file/folder outside sync folder updates server and preserves content | Move dehydrated file/folder to desktop (outside of sync folder) | File/Folder is moved and content is correct <br/> File/Folder is deleted on the server | | | 
| 9  | Verify new file added from client is hydrated and uploaded to server | [Automated] Add a new file from the client | File is hydrated and uploaded to the server | | | 
| 10  | Verify new file from server appears with correct VFS status based on parent folder | [Automated] Add a new file from the server | Status of root file is ""Online only"" <br/> Otherwise based on the status of the parent folder [#6815](https://github.com/owncloud/client/issues/6815#issuecomment-512247733) New remote items in folders that are pinned initially show up as hydrated, otherwise they start dehydrated | | | 
| 11  | Verify moving files and folders locally within sync updates server correctly | Move file and directory locally within sync folder | Both dehydrated and hydrated files are moved accordingly on the server | | | 
| 12  | Verify moving an empty dehydrated folder updates server and shows cloud icon | Move an empty dehydrated folder inside the sync root | Moved on server accordingly <br/> Destination folder has Cloud icon | | | 
| 13  | Verify files and folders moved on server sync locally | Move file and directory on the server | Both dehydrated and hydrated files are moved accordingly locally | | | 
| 14  | Verify open file is removed locally after server-side directory deletion | Create file in directory and open with LO. Do not change. Remove the directory on the server. | After closing LO, directory and file are removed. | | | 
| 15  | Verify edited open file recreates deleted directory | Create file in directory and open with LO. Remove the directory on the server. Edit the file and save it. | After closing LO, directory and file are created again. | | | 
| 16  | Verify filename case clash is reported on client | On server, create two files ""NewFile"" and ""Newfile"" inside a folder ""FolderA"" <br/> Observe client | A red error message syaing ""...file name clash..."" is shown for some seconds <br/> Then the ""i"" icon is shown <br/> ""Not synced' tab also shows file name clashed error | | | 
| 17  | Verify folder and file show sync pending status and icon | Check the Status of FolderB and NewFile in the File Explorer | Sync pending status and icon for both folder and file | | | 
| 18  | Verify moving FolderB outside sync root updates local and server correctly without filename clash errors | Move FolderB to another place (outside the sync root) | FolderB is moved locally <br/> FolderB is not deleted from the server <br/> A file previously synced locally gets deleted from the server as well <br/> Another not synced file gets synced to the client <br/> No Error messages related to file name clash | | | 
| 19  | Verify repeated editing of a file with VFS keeps status correct and syncs changes | 1. Add an account with VFS on <br/> 2. Create a presentation file <br/> 3. Open, edit, save, and close the file using PowerPoint/LibreOffice for several times in a row (3-4 times) <br/> 4. Check the Status of file in the File Explorer | State is correct, changes synced to the server | | | 
| 20  | Verify no error when a placeholder is replaced by a folder on the server after client restart | 1. Have a win vfs placeholder <br/> 2. Quit the client <br/> 3. Remove that file on the server <br/> 4. Create a folder with the same name on the server <br/> 5. Start the client | No error | | | 

## 3. Automatically dehydrate

### Precondition

Add an account with VFS ON 

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Skip test – handled automatically by Windows Storage Sense | DO NOT TEST; this is managed by Windows storage sense <br/> Make sure your computer is running low on free space <br/> Try to hydrate a large file from the sync folder | File has been dehydrated automatically. GitHub issue: [#7470](https://github.com/owncloud/client/issues/7470) | | | 
| 2  | Skip test – automatic file dehydration is managed by Windows Storage Sense | DO NOT TEST; this is managed by Windows storage sense <br/> Automatically dehydrate files that have not been used for X days  <br/> Number of days will be set in Settings  <br/> There will be no entry in owncloud submenu | Automatic dehydration of not used files <br/> GitHub issue [#7402](https://github.com/owncloud/client/issues/7402) | | | 
| 3  | Verify "Free up space" on folder correctly dehydrates all files and maintains placeholders | 1. Create several new files in a subfolder, edit some of them, also have dehydrated files available <br/> 2. 'Open folder', right click on the folder in Explorer, 'Free up space' in Windows file menu | All files are dehydrated, check all placeholder files are there, check trash bin on server | | | 
| 4  | Verify moving dehydrated files into a new folder preserves dehydration and removes them from original location | Create a new folder and move (also use 'Cut' and'Paste') several dehydrated files into it | All files are moved into the folder, remain dehydrated and disappear from previous location <br/> Github issue: [#9101](https://github.com/owncloud/client/issues/9101) | | | 

## 4. Pin inheritance

### Precondition

Pinned - ""Always keep on this device"" (icon: white tick in green circle) <br/>
Hydrated - File content is downloaded (icon: green tick with green stroke) <br/>
Dehydrated - ""Free up space"" (icon: cloud) 

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify new server file in existing local folder syncs as dehydrated | 1.  From File Explorer, create a folder in the sync path <br/> 2. Let the sync complete <br/> 3. Add a new file on the server into that folder | The file has been synced and it's dehydrated | | | 
| 2  | Verify new server file in pinned folder is synced as pinned | 1.  Have a folder that is pinned <br/> 2. Add a new file on the server into that folder | The file has been synced and it's pinned as well <br/> GitHub issue: [#6815](https://github.com/owncloud/client/issues/6815#issuecomment-512247733) | | | 
| 3  | Verify recreated server file inherits pin state in pinned folder | 1.  Create a file ""lorem.txt"" in a pinned folder <br/> 2. Mark ""lorem.txt"" dehydrated then let the sync complete <br/> 3. Delete ""lorem.txt"" on the server and wait sync <br/> 4. Create file ""lorem.txt"" on the server into that folder | It should be hydrated and inherit the always-local pin state. <br/> GitHub issue : [#7273](https://github.com/owncloud/client/issues/7273) | | | 
| 4  | Verify new local file in unpinned folder is hydrated but not pinned | 1.  Have a folders that is not pinned <br/> 2. Add a new file locally into that folder | File is hydrated but not pinned | | | 

## 5. Forbidden file types

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify files with .owncloud extension are ignored when VFS is enabled | 1. Turn VFS on <br/> 2. Add a file ending .owncloud in the client | File is ignored | | | 
| 2  | Verify files with .owncloud extension are ignored when VFS is disabled | 1. Turn VFS off <br/> 2. Add a file ending .owncloud in the client | File is ignored | | | 

## 6. Tests when a file or folder is locked

### Precondition

Use file lock detection tool such as https://lockhunter.com/?utm_source=saashub&utm_medium=marketplace&utm_campaign=saashub <br/>
LO means LibreOffice, which locks the file opened in it 

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify freeing up space on a locked file shows correct pending status without errors | 1. Add an account with VFS ON <br/> 2. Open a file in LibreOffice <br/> 3. Edit content and save it <br/> 4. DO NOT exit (locks the file) <br/> 5. ""Free up space"" in the File Explorer of the locked file | - No error message in the client <br/> - Client shows ""i"" icon <br/> - ""Not Synced"" tab of Activity tells that the file is in use <br/> - File Status: Sync pending <br/> - Icon: Two blue arrows | | | 
| 2  | Verify file is dehydrated and status updates correctly after closing LibreOffice | Exit libreoffice | - File is dehydrated <br/> - File Status: Available when online <br/> - Icon: Cloud | | | 
| 3  | Verify freeing up space on a folder with an open (locked) file handles lock and dehydration correctly | 1. Have a folder with some hydrated files <br/> 2. Open one of the files in LO <br/> 3. ""Free up space"" in Explorer of that folder <br/> 4. Observe the sync status in explorer and client <br/> 5. Quit the LO |  <br/> - File opened in LO stays locked <br/> - Lock file status: Sync pending <br/> - Icon: Two blue arrows <br/><br/> - Other non locked files are dehydrated <br/> - Other files: Available when online <br/> - Icon: Cloud <br/><br/> - Folder Status: Sync pending <br/> - Icon: Two blue arrows <br/><br/> - After LO is closed, the locked file gets dehydrated and folder has Cloud icon | | | 
| 4  | Verify new file created in LO syncs correctly and updates status before and after closing LO | 1. Create a new file from LO into the local sync folder <br/> 2. Keep it opened in LO <br/> 3. Observe the sync status in explorer and client <br/> 4. Quit the LO | File is synced <br/> File is on the server <br/><br/>  When the file is opened in LO: <br/> - Status: Sync pending <br/> - Icon: Two blue arrows <br/><br/> When LO is closed: <br/> - Status: Available on this device <br/> - Icon: Green tick in a circle with green stroke | | | 
| 5  | Verify moving a locked file to a server folder handles sync correctly before and after closing LO | 1. Open a file in LO <br/> 2. Move that locked file into a folder on the server <br/> 3. Observe the status <br/> 4. Quit the LO | - Client shows ""i"" icon <br/> - ""Not Synced"" tab of Activity tells that the file is in use <br/> - Destination folder has status ""Sync pending"" <br/>  <br/> After closing LO: <br/> - File is moved locally <br/> - File Status: Available on this device | | | 
| 6  | Verify deletion of a locked file on the server handles local lock and removal correctly | 1. Open a file in LO <br/> 2. Delete that locked file on the server | Client shows ""i"" icon <br/> ""Not Synced"" tab of Activity tells that the file is in use <br/><br/> File stays locally <br/><br/> After LO is closed, file is removed if it was NOT changed locally after the delete | | | 
| 7  | Verify edited locked file deleted on server is synced as new file after closing LO | 1. Open a file in LO <br/> 2. Edit content and save to create file versions <br/> 3. Delete that locked file on the server <br/> 4. Change the file content again in LO and save | - Client shows ""i"" icon <br/> - ""Not Synced"" tab of Activity tells that the file is in use <br/><br/> - After LO is closed, the file is synced to the server as a new file <br/><br/> - No version history any more. | | | 
| 8  | Verify editing a file after server move creates new file locally and syncs correctly | 1. Open a file in LO <br/> 2. Move that file on the server <br/> 3. Edit the file content in LO and save <br/> 4. Quit the LO | - The file gets moved to the destination folder locally <br/> - New file appears with the former name and syncs to the server | | | 
| 9  | Verify local folder is renamed correctly after server-side folder rename while file is open in LO | 1. Open a file from inside a folder in LO <br/> 2. Rename that folder on the server <br/> 3. Quit the LO | The directory is renamed locally | | | 
| 10  | Verify folder rename on server and file edit in LO sync correctly locally and to server | 1. Open a file from inside a folder in LO <br/> 2. Rename that folder on the server <br/> 3. Edit the file content in LO and save <br/> 4. Quit the LO | - The directory is renamed locally <br/> - The content of file is changed in the server  | | | 
| 11  | Verify Windows Office "Save and Keep Open" syncs file to server correctly | Windows office file save and keep open | Windows office save (and keep open) causes the client to sync the file to the server. OK. | | | 

## 7. Test with a long path

### Precondition

make sure LongPathsEnabled in Windows registry is off ** <br/>
** The client should handle a long path > 260 correctly despite the registration setting is off (for registry key see https://docs.microsoft.com/en-us/windows/win32/fileio/maximum-file-path-limitation?tabs=cmd).

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify syncing a file with path length exceeding MAX_PATH (>260 chars) works correctly | On server: create a file (~30 chars) inside 6 subfolders (each ~50 chars) to get a path length >260 chars (exceeds MAX_PATH). <br/> - Use 'Open Folder' from client dot menu | The file is synced correctly (status: cloud icon for folders and file) | | |
| 2  | Verify edited long-path file shows fully synced status after save and exit | Edit the file, save and exit | Status: full file icon for the file (and all folders) | | | 
| 3  | Verify "Free up space" on top-level folder updates all statuses to cloud without errors | Right click on top most folder and 'Free up space' | No red error message, status turns to cloud icon for all folders and the file | | | 

## 8. Test with ignored or 'problematic' files

### Precondition

See https://doc.owncloud.com/desktop/2.9/filenames.html

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify files on the ignore list (e.g., .part) are not synced | Test with files that are on the ignore list, ie. files with the extension .part | They will be ignored in the sync | | | 

## 9. Switch between VFS ON/OFF

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify enabling VFS on a second account updates file status and icons correctly | - Add a second account with VFS OFF <br/> - Enable VFS using the three dots (...) menu | - File status changes in the file explorer <br/> - Icons shown in the ""Status"" column of the file explorer <br/><br/> Status: Available on this device <br/> Icon: Green tick (Cirle with white fill and green stroke) | | | 
| 2  | Verify "Free up space" on a folder dehydrates all files and updates status/icons | In File Explorer: <br/> Right-click on a folder and 'Free up space' | All files in the folder get dehydrated (placeholder file) <br/><br/> Status: Available when online <br/> Icon: cloud | | | 
| 3  | Verify disabling VFS downloads all files and updates overlay icons correctly | Disable the VFS | - All files are downloaded <br/> Overlay icons are shown: icons on top of files/folders (White tick in solid green circle) <br/> - Icons are removed from the ""Status"" column of the file explorer | | | 

## 10. Client sync operations

| ID | Test Case                                   | Steps to reproduce                                                                                                                                                                                                              | Expected Result                                                                                                                                | Result | Related Comment |
|----|---------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------|--------|-----------------|
| 1  | Verify pausing sync with VFS on prompts confirmation and stops sync with "Operation cancelled" | - VFS on <br/> - 'Pause sync' (on client dot menu) while client is syncing | A confirmation window has been opened to confirm stopping the operation. After confirmation the sync has been stopped with an error message ""Operation cancelled"" | | | 
| 2  | Verify resuming sync continues and completes successfully | 'Resume sync' | Sync is continued and runs successfully | | | 
| 3  | Verify client continues syncing after machine standby, suspend, hibernate, or laptop lid close | - Switch machine status (standby, suspend, hybernate ...) <br/> - Close lid of a laptop while client is syncing | Reopen and see client continues the sync | | | 
| 4  | Verify client resumes syncing after Windows hibernate and relogin | On Windows VM command line: call `shutdown /h` | Client continues after relogin | | | 
